<!DOCTYPE html>
<html>

<head>
	<title>math</title>
	<link rel="stylesheet" type="text/css" href="css/site.css">
	<script type="text/javascript" src="js/site.js"></script>
	<script type="text/javascript" src="js/math.js"></script>

	<style>
		body {
			font-size: 50px;
			height: 100%
		}
		input {
			font-size: 50px;
		}	
	</style>
	<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
	<!--<script src="jquery.js"></script>-->
	<script>

	</script>
	<script>		
		var enabledCalcItems = [];
		var operatorMap = {
			'+': '+',
			'-': '-',
			'*': '&times;', // &times; or &#215;
			'/': '&divide;' // &divide; or &#247;
		}

		var right = 0;
		var total = 0;
		var calcItem;
		var num1;
		var num2;
		
		var questionCount=5;
		var questionArr = [];

		$(() => {
			availCalcItems.forEach((item, index) => {
				var v = getURLParameter(item.name);
				if (v) {
					var level = parseInt(v);
					if (level >=0 ) {
						item.level = level;
					}
				}
			});
			
			enabledCalcItems = availCalcItems.filter(item => item.level >= 0);
			if (enabledCalcItems.length == 0) {
				availCalcItems[0].level = 0;
				enabledCalcItems.push(availCalcItems[0]);
			}


			initNumber();
			showResult();
		});

		function showResult() {
			$("#right").text(right);
			$("#total").text(total);
		}

		function initNumber() {
			var indexCalc = Math.floor(Math.random() * enabledCalcItems.length);
			calcItem = enabledCalcItems[indexCalc];
			[num1, num2] = calcItem.initNumber();
			
			$("#num1").text(num1);
			$("#num2").text(num2);
			$("#operator").html(operatorMap[calcItem.operator]);
			$("#txtResult").val("").focus();
		}

		function onResult() {
			var r = $("#txtResult").val();
			if (r == "") {
				$("#txtResult").focus();
				return;
			}

			if (calcItem.isRight(num1, num2, r)) {
				right++;
			}
			total++;
			showResult();
			log(r);

			initNumber();
		}

		function log(r) {
			var s = num1 + " " + operatorMap[calcItem.operator] + " " + num2 + " = " + r;
			var item = $("<div/>").html(s);

			if (calcItem.isRight(num1, num2, r)) {
				item.addClass("right");
			} else {
				item.addClass("wrong");
			}
			$("#log").append(item);
		}
	</script>

</head>

<body>
	<div id="result">Score: <span id="right"></span> / <span id="total"></span></div>

	<div>
		<span id="num1"></span> <span id="operator"></span> <span id="num2"></span> =
		<span> <input id="txtResult" type="number" maxlength="3" /></span>
		<span> <input id="btnResult" type="button" value="Summit" onclick="onResult();"></span>
	</div>


	<div id="log">
	</div>
</body>

</html>